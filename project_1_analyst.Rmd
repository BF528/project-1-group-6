---
title: "Analyst role for project 1"
author: "Simran"
date: "1/31/2020"
output: word_document
---

## Noise Filtering and Dimensionality Reduction (Part 4)

# load data
```{r}
intensity_data <- read.table("example_intensity_data.csv")

```

# Implement the following filters on the RMA normalized, ComBat adjusted expression matrix:

1. Expressed in at least 20% of samples (i.e. for each gene, at least 20% of the gene-expression values must be > 𝑙𝑜𝑔2(15)).
```{r}

expressed <- function(probe) {
  percent <- sum(probe > log2(15))/ncol(intensity_data)
  if (percent >= .20) { return(TRUE) } 
  else { return(FALSE) }
}

expression_vec <- apply(intensity_data, 1, expressed)
data_1 <- intensity_data[expression_vec,]

```

2. Have a variance significantly different from the median variance of all probe sets using a threshold of 𝑝<0.01 (hint: use a chi-squared test as shown in http://www.itl.nist.gov/div898/handbook/eda/section3/eda358.htm. You will need to manually compute the test statistic for each gene and compare it to the chi-squared distribution with the correct number of degrees of freedom using the qchisq() function).
```{r}
filter2_data <- filter1_data

```

3. Have a coefficient of variation > 0.186.
```{r}
covs <- apply(data_2, 1, var) 
good_covs <- which(covs > 0.186)
data_3 <- data_2[good_covs,]

```

# Deliverables:

A comma separated file with the filtered results from all three filters from 4.4. Write out a different file containing the gene expression matrix for genes passing all three of the filters from 4.1, 4.2, and 4.3.

```{r}
write.csv(filter3_data, "filtered_expression_matrix.csv")

```

Report the number of genes that pass all of these thresholds.
```{r echo = FALSE}
paste0("number of genes that pass all thresholds: ", ncol(filter3_data))

```

For groups with Biologist role only: A comma separated file with the filtered results from the expression filter from 4.2. For groups with Biologist role only: Write out the expression matrix for probesets that pass the expression threshold from 4.2 to a file with write.csv. (???)
```{r}
write.csv(filter2_data, "filter2_expression_matrix.csv")

```


## Hierarchical clustering & subtype discovery (Part 5)

1. Perform hierarchical clustering on your fully filtered data matrix from Part 4.4. Be sure to check that you are clustering the patients and not the genes.
```{r}

```

2. Cut the dendrogram such that the samples are divided into 2 clusters. How many samples are in each cluster?
```{r}

```

3. Create a heatmap of the gene-expression of each gene across all samples using the heatmap() function. Include a column colorbar by setting the ColSideColors variable in the heatmap function equal to “red” if the sample belongs to the C3 subtype and “blue” otherwise. Subtype annotation can be found in the annotation matrix under the title cit-coloncancermolecularsubtype.
```{r}

```

4. Using the expression matrix from Part 4.4 and the cluster memberships from Part 5.2, identify genes differentially expressed between the two clusters using a Welch t-test (results in a ranked list). Write out a dataframe containing the probeset ID, t-statistic, p-value, and adjusted p-value (i.e. FDR, see the p.adjust function) to a comma separated file for each comparison. How many genes are differentially expressed at adjusted 𝑝<0.05 between the clusters for both lists?
```{r}

```

5. Select the most differentially expressed genes that you feel best define the clusters and explain your selection.
```{r}

```

6. For groups with Biologist role only: perform the t-test analysis described in 5.4 on the expression matrix from 4.5 as well and provide to the Biologist as a csv file.
```{r}

```

# Deliverables
Report the number of samples in each cluster from Part 5.2
```{r}

```

A heatmap of the genes and samples with a color bar indicating which subtype each sample belongs to
report the number of differentially expressed genes at 𝑝<0.05 between the two clusters
```{r}

```

A comma separated file containing the results of the Welch t-test for all genes irrespective of significance for each subtype comparison
```{r}

```

Report a list of the genes you feel best represent each cluster and explain how you came to your conclusion
```{r}

```

For groups with Biologist role only: A comma separated file with the t-test results computed on the expression matrix from 4.5.
```{r}

```




